{% extends "auctions/layout.html" %}

{% block body %}
{% if message %}
<!-- Message to display when any user changes something on this page -->
<div class="alert alert-success" role="alert">
    <strong>Success! </strong> {{message}}
</div>
{% elif simple_message and user.is_authenticated %}
{% if request.user.username == max_bidder %}
<div class="alert alert-info" role="alert">
    <strong>Congrats, </strong>You{{simple_message}}!
</div>
{% elif request.user.username == listing.created_by %}
<div class="alert alert-info" role="alert">
    <strong>{{max_bidder}}</strong> {{simple_message}}
</div>
{% else %}
<div class="alert alert-info" role="alert">
    {{simple_message}}
</div>
{% endif %}
{% elif error_message %}
<!-- Error Message -->
<div class="alert alert-danger" role="alert">
    <strong>Error! </strong> {{error_message}}.
</div>
{% endif %}

<!-- Displaying the details of the listing -->
<center>
    <h2>{{listing.title}}</h2>
</center>
{{listing.description}} <br>
<img src="{{listing.image_url}}"> <br>
Category: {{listing.category}} <br>
Created When: {{listing.added_when}} <br>
Created By: {{listing.created_by}} <br>

<!-- Biding part --->
Max Bid Till Now: Rs. {{max_bid_till_now}} made by {{max_bidder}}

{% if user.is_authenticated and listing.active %}
<form action="add_bid" method="POST">
    {% csrf_token %}
    Enter Bid: (Rs)
    <input type="number" name="amount">
    <button name="listing" value="{{listing.id}}">My Bid</button>
</form>
{% endif %}

{% if request.user.username == listing.created_by and listing.active %}
<!-- End listing button -->
<form action="{{listing.id}}" method="POST">
    {% csrf_token %}
    <input name="max_bid_till_now" value="{{max_bid_till_now}}" hidden>
    <input name="MaxBidderName" value="{{max_bidder}}" hidden>
    <input type="submit" value="End Listing">
</form>
{% endif %}

<!-- Watchlist button -->
{% if listing not in request.user.watchlist.all %}
<form action="watchlist" method="POST">
    {% csrf_token %}
    <button name="listing" value="{{listing.id}}">Add to watchlist</button>
</form>
{% elif listing in request.user.watchlist.all %}
<form action="remove" method="POST">
    {% csrf_token %}
    <button name="listing" value="{{listing.id}}">Remove from watchlist</button>
</form>
{% endif %}

<!-- Comments -->
{% if user.is_authenticated %}
<form action="add_comment" method="POST">
    {% csrf_token %}
    <input type="text" name="comment" placeholder="Comment..."><br>
    <button name="listing" value="{{listing.id}}">Add Comment</button>
</form>
{% endif %}

<h2 class="text-muted">All Comments</h2>
<ul>
    {% for comment in comments %}
    <li>
        <h4 class="text-muted">{{comment.who_added.username}}</h4> {{comment.description}}
    </li>
    {% empty %}
    <li>No Comment Yet...</li>
    {% endfor %}
</ul>
{% endblock %}